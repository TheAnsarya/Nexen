<Window
	xmlns="https://github.com/avaloniaui"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:m="clr-namespace:Nexen"
	xmlns:c="using:Nexen.Controls"
	xmlns:vm="using:Nexen.ViewModels"
	xmlns:l="using:Nexen.Localization"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="600"
	x:Class="Nexen.Windows.TasEditorWindow"
	Width="900" Height="600"
	MinWidth="600" MinHeight="400"
	x:DataType="vm:TasEditorViewModel"
	Title="{Binding WindowTitle}"
>
	<Design.DataContext>
		<vm:TasEditorViewModel />
	</Design.DataContext>

	<DockPanel>
		<!-- Menu Bar -->
		<c:NexenMenu DockPanel.Dock="Top" Name="MainMenu">
			<MenuItem Header="File" ItemsSource="{Binding FileMenuItems}" />
			<MenuItem Header="Edit" ItemsSource="{Binding EditMenuItems}" />
			<MenuItem Header="View" ItemsSource="{Binding ViewMenuItems}" />
		</c:NexenMenu>

		<!-- Toolbar -->
		<Border DockPanel.Dock="Top" BorderBrush="Gray" BorderThickness="0 0 0 1" Padding="5">
			<StackPanel Orientation="Horizontal" Spacing="5">
				<Button Content="Open" ToolTip.Tip="Open movie file" />
				<Button Content="Save" ToolTip.Tip="Save movie file" IsEnabled="{Binding HasUnsavedChanges}" />
				<Rectangle Width="1" Fill="Gray" Margin="5 0" />
				<Button Content="+" ToolTip.Tip="Insert frame" Width="30" />
				<Button Content="-" ToolTip.Tip="Delete frame" Width="30" />
				<Rectangle Width="1" Fill="Gray" Margin="5 0" />
				<ToggleButton Content="GZ" ToolTip.Tip="Toggle greenzone" IsChecked="{Binding IsGreenzoneEnabled}" />
			</StackPanel>
		</Border>

		<!-- Status Bar -->
		<Border DockPanel.Dock="Bottom" BorderBrush="Gray" BorderThickness="0 1 0 0" Padding="5">
			<Grid ColumnDefinitions="*,Auto,Auto,Auto">
				<TextBlock Grid.Column="0" Text="{Binding StatusMessage}" VerticalAlignment="Center" />
				<TextBlock Grid.Column="1" Text="Frame: " VerticalAlignment="Center" Margin="10 0 0 0" />
				<TextBlock Grid.Column="2" Text="{Binding SelectedFrameIndex}" VerticalAlignment="Center" />
				<TextBlock Grid.Column="3" VerticalAlignment="Center" Margin="10 0 0 0">
					<TextBlock.Text>
						<MultiBinding StringFormat="/ {0}">
							<Binding Path="Movie.InputFrames.Count" FallbackValue="0" />
						</MultiBinding>
					</TextBlock.Text>
				</TextBlock>
			</Grid>
		</Border>

		<!-- Main Content -->
		<Grid>
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="*" />
				<ColumnDefinition Width="5" />
				<ColumnDefinition Width="250" />
			</Grid.ColumnDefinitions>

			<!-- Frame List (ListBox) -->
			<Border Grid.Column="0" BorderBrush="Gray" BorderThickness="1">
				<ListBox
					Name="FrameList"
					ItemsSource="{Binding Frames}"
					SelectedIndex="{Binding SelectedFrameIndex}"
					SelectionMode="Single"
					FontFamily="Consolas"
					FontSize="12"
				>
					<ListBox.ItemTemplate>
						<DataTemplate>
							<Grid ColumnDefinitions="60,120,120,40,*" Background="{Binding Background}">
								<TextBlock Grid.Column="0" Text="{Binding FrameNumber}" />
								<TextBlock Grid.Column="1" Text="{Binding P1Input}" />
								<TextBlock Grid.Column="2" Text="{Binding P2Input}" />
								<TextBlock Grid.Column="3" Text="{Binding IsLagFrame}" />
								<TextBlock Grid.Column="4" Text="{Binding CommentText}" />
							</Grid>
						</DataTemplate>
					</ListBox.ItemTemplate>
				</ListBox>
			</Border>

			<!-- Splitter -->
			<GridSplitter Grid.Column="1" Width="5" ResizeDirection="Columns" />

			<!-- Properties Panel -->
			<Border Grid.Column="2" BorderBrush="Gray" BorderThickness="1">
				<ScrollViewer>
					<StackPanel Margin="10" Spacing="10">
						<!-- Frame Info -->
						<TextBlock Text="Frame Properties" FontWeight="Bold" FontSize="14" />
						<Rectangle Height="1" Fill="Gray" />

						<Grid RowDefinitions="Auto,Auto" ColumnDefinitions="Auto,*">
							<TextBlock Text="Frame #:" VerticalAlignment="Center" />
							<TextBlock Grid.Column="1" Text="{Binding SelectedFrameIndex}" Margin="5 0 0 0" VerticalAlignment="Center" />

							<TextBlock Grid.Row="1" Text="Lag Frame:" VerticalAlignment="Center" Margin="0 5 0 0" />
							<CheckBox Grid.Row="1" Grid.Column="1" IsChecked="False" Margin="5 5 0 0" />
						</Grid>

						<!-- Controller 1 -->
						<TextBlock Text="Controller 1" FontWeight="Bold" FontSize="14" Margin="0 10 0 0" />
						<Rectangle Height="1" Fill="Gray" />

						<WrapPanel>
							<!-- D-Pad -->
							<StackPanel Orientation="Vertical" Margin="0 0 20 0">
								<Button Content="↑" Width="30" Height="30" HorizontalAlignment="Center" Tag="UP" Click="OnButtonClick" />
								<StackPanel Orientation="Horizontal">
									<Button Content="←" Width="30" Height="30" Tag="LEFT" Click="OnButtonClick" />
									<Border Width="30" Height="30" />
									<Button Content="→" Width="30" Height="30" Tag="RIGHT" Click="OnButtonClick" />
								</StackPanel>
								<Button Content="↓" Width="30" Height="30" HorizontalAlignment="Center" Tag="DOWN" Click="OnButtonClick" />
							</StackPanel>

							<!-- Face Buttons -->
							<StackPanel Orientation="Vertical" Margin="10 0 20 0">
								<Button Content="X" Width="30" Height="30" HorizontalAlignment="Center" Tag="X" Click="OnButtonClick" />
								<StackPanel Orientation="Horizontal">
									<Button Content="Y" Width="30" Height="30" Tag="Y" Click="OnButtonClick" />
									<Border Width="30" Height="30" />
									<Button Content="A" Width="30" Height="30" Tag="A" Click="OnButtonClick" />
								</StackPanel>
								<Button Content="B" Width="30" Height="30" HorizontalAlignment="Center" Tag="B" Click="OnButtonClick" />
							</StackPanel>

							<!-- Shoulder/Start/Select -->
							<StackPanel Orientation="Vertical" Spacing="5">
								<StackPanel Orientation="Horizontal" Spacing="5">
									<Button Content="L" Width="40" Height="25" Tag="L" Click="OnButtonClick" />
									<Button Content="R" Width="40" Height="25" Tag="R" Click="OnButtonClick" />
								</StackPanel>
								<StackPanel Orientation="Horizontal" Spacing="5">
									<Button Content="SEL" Width="40" Height="25" Tag="SELECT" Click="OnButtonClick" />
									<Button Content="STA" Width="40" Height="25" Tag="START" Click="OnButtonClick" />
								</StackPanel>
							</StackPanel>
						</WrapPanel>

						<!-- Movie Info -->
						<TextBlock Text="Movie Info" FontWeight="Bold" FontSize="14" Margin="0 10 0 0" />
						<Rectangle Height="1" Fill="Gray" />

						<Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="Auto,*">
							<TextBlock Text="Format:" VerticalAlignment="Center" />
							<TextBlock Grid.Column="1" Text="{Binding Movie.SourceFormat, FallbackValue=None}" Margin="5 0 0 0" VerticalAlignment="Center" />

							<TextBlock Grid.Row="1" Text="Frames:" VerticalAlignment="Center" Margin="0 5 0 0" />
							<TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Movie.TotalFrames, FallbackValue=0}" Margin="5 5 0 0" VerticalAlignment="Center" />

							<TextBlock Grid.Row="2" Text="Rerecords:" VerticalAlignment="Center" Margin="0 5 0 0" />
							<TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding Movie.RerecordCount, FallbackValue=0}" Margin="5 5 0 0" VerticalAlignment="Center" />

							<TextBlock Grid.Row="3" Text="Author:" VerticalAlignment="Center" Margin="0 5 0 0" />
							<TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding Movie.Author, FallbackValue=Unknown}" Margin="5 5 0 0" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" />
						</Grid>
					</StackPanel>
				</ScrollViewer>
			</Border>
		</Grid>
	</DockPanel>
</Window>
